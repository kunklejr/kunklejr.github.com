
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Node.js Basics Explained - Jeff Kunkle's Blog</title>
  <meta name="author" content="Jeff Kunkle">

  
  <meta name="description" content="Rising from non-existence three short years ago, Node.js is already attracting the accolades and disdain enjoyed and endured by the Ruby and Rails &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kunkle.org/blog/2012/04/13/nodejs-basics-explained/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jeff Kunkle's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37321329-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jeff Kunkle's Blog</a></h1>
  
    <h2>a blog about software and related stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kunkle.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Node.js Basics Explained</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-13T10:02:42-04:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Rising from non-existence three short years ago, Node.js is already attracting the accolades and disdain enjoyed and endured by the Ruby and Rails community just a short time ago. It overtook Rails as the most popular Github repository last November (now superseded by Twitter&#8217;s Bootstrap project) and was selected by InfoWorld for the Technology of the Year Award in 2012.</p>

<p>If you&#8217;ve never used Node.js before or have limited experience, it may not be obvious why people are so excited about it. This post will attempt to explain the basic theory central to Node&#8217;s approach, arming you with a better frame of reference for the debates you&#8217;ll undoubtedly encounter.</p>

<p>Please note that this post won&#8217;t make much sense without a very basic familiarity with Node. Consider checking out the <a href="http://nodejs.org">Node.js website</a> and reading a few articles on Node first if that&#8217;s the case.</p>

<h1>I/O Latency</h1>

<p>The core premise behind Node&#8217;s approach is that I/O operations are slow compared to the computation done in your application. Consider the table below, taken from Ryan Dahl&#8217;s 2008.11.08 presentation on Node.js. It shows various I/O operations on the left and the number of CPU cycles it takes to perform them. Don&#8217;t focus on the actual numbers, but on the differences in magnitude for the  operations.</p>

<table>
    <tr><th>Operation</th><th>CPU cycles</th></tr>
    <tr><td>L1</td><td align="right">3</td></tr>
    <tr><td>L2</td><td align="right">14</td></tr>
    <tr><td>RAM</td><td align="right">250</td></tr>
    <tr><td>Disk</td><td align="right">41,000,000</td></tr>
    <tr><td>Network</td><td align="right">240,000,000</td></tr>
</table>


<p>From the table you can see that disk and network access times dwarf things like memory access or L1 and L2 cache access. The chart below makes the magnitude differences even more obvious. The L1, L2, and RAM access times are so much smaller than disk and network access that their bars don&#8217;t even appear on the graph.</p>

<p><img src="/assets/latency-bar-graph.png" title="I/O Latency" alt="i/o magnitudes" /></p>

<h1>Waiting</h1>

<p>If you can buy that I/O operations are often orders of magnitude slower than the computation you&#8217;re performing in your app, then what is your app doing during the I/O operations? It&#8217;s waiting! It&#8217;s execution is literally blocked until the I/O operation completes.</p>

<p>Consider the following fictitious web request. The slim green bars represent the time your application devotes to processing and the gray bars represent the time spent waiting for I/O to complete. The example starts off with some logic to process the request.</p>

<ol>
<li>Parse the request and invoke the appropriate controller logic</li>
<li>Initiate a database query or maybe a request to an external service</li>
<li>Wait for I/O</li>
<li>Process the query results and write some data to a log file</li>
<li>Wait for I/O</li>
<li>Perform some final formatting of the results and return them to the client</li>
</ol>


<p><img src="/assets/waiting.png" title="Waiting" alt="waiting" /></p>

<p>The vast majority of time spent during the request involved waiting for the I/O operations, and there were only two. Very little time is actually used to perform application-specific processing. Node.js was designed from the start to exploit this imbalance.</p>

<h1>Scaling</h1>

<p>Before we get into the approach Node.js takes to scaling, let&#8217;s consider how our made-up web request would be scaled with other models.</p>

<h2>Scaling with Threads</h2>

<p>Using a thread based model, you&#8217;d scale the above example by creating multiple threads, one for each concurrent connection. The diagram below depicts a threaded model capable of handling four concurrent connections.</p>

<p><img src="/assets/scaling-threads.png" title="Scaling with Threads" alt="scaling with threads" /></p>

<p>While this approach allows us to scale by adding more threads, each thread still spends most of its time waiting for I/O, not processing your application logic. Unfortunately, continuing to add threads introduces context switching overhead and uses considerable memory to maintain execution stacks.</p>

<h2>Scaling with Processes</h2>

<p>Another popular approach to scaling your application is to run multiple processes. As you can see from the diagram below, the theory behind scaling with multiple processes is basically the same as scaling with threads, although it does use more memory. Like the threading model, each process still spends most of its time waiting on I/O.</p>

<p><img src="/assets/scaling-processes.png" title="Scaling with Processes" alt="scaling with processes" /></p>

<h2>Scaling with Node.js</h2>

<p>Since the code you write for Node.js executes in a single thread within a single process, it takes a different approach to scaling. It extracts the &#8220;I/O waiting&#8221; by using an internal thread pool or leveraging asynchronous I/O APIs of the host operating system to free your thread for processing other connections. Instead of your code blocking on I/O operations, it&#8217;s freed to process other connections. When the I/O operation completes, your code is called back to handle the results.</p>

<p><img src="/assets/scaling-event-loop.png" title="Scaling with Node.js" alt="scaling with event loop" /></p>

<p>With Node.js your code never blocks for I/O operations, eliminating those long gray bars of waiting time. This non-blocking mode of operation is what allows Node.js to handle large numbers of concurrent connections without overly-straining system resources.</p>

<h1>Conclusion</h1>

<p>The success of Node.js relies on the premise that time spent waiting for I/O far outweighs the time spent executing application logic. While that&#8217;s true of many of todays&#8217; web/network-based applications, it doesn&#8217;t always apply. If your application is more CPU-intensive with minimal I/O by comparison, then Node.js is probably not the right platform. As my father used to say, don&#8217;t try to fit a square peg in a round hole.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jeff Kunkle</span></span>

      








  


<time datetime="2012-04-13T10:02:42-04:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://kunkle.org/blog/2012/04/13/nodejs-basics-explained/" data-via="kunklejr" data-counturl="http://kunkle.org/blog/2012/04/13/nodejs-basics-explained/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/01/26/automatic-code-coverage-switch/" title="Previous Post: Automatic Code Coverage Switching for Vows.js">&laquo; Automatic Code Coverage Switching for Vows.js</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/06/13/secret-sauce-of-nodejs-modules/" title="Next Post: Secret Sauce of NodeJS Modules">Secret Sauce of NodeJS Modules &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/08/28/nodejs-test-coverage-reporting-with-covershot/">NodeJS Test Coverage Reporting with CoverShot</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/14/tech-presentation-tip-3-mirror-displays/">Tech Presentation Tip 3 - Mirror Displays</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/06/tech-presentation-tip-2-no-apologies-or-caveats/">Tech Presentation Tip 2 - No Apologies or Caveats</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/26/tech-presentation-tip-1-avoid-screen-resolution-shock/">Tech Presentation Tip 1 - Avoid Screen Resolution Shock</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/12/introducing-db-meta-for-nodejs/">Introducing db-meta for NodeJS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/kunklejr">@kunklejr</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kunklejr',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("kunklejr", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/kunklejr" class="twitter-follow-button" data-show-count="false">Follow @kunklejr</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/108076180146802069516?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jeff Kunkle -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jkunkle-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kunkle.org/blog/2012/04/13/nodejs-basics-explained/';
        var disqus_url = 'http://kunkle.org/blog/2012/04/13/nodejs-basics-explained/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
