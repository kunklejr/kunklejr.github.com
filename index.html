
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Jeff Kunkle's Blog</title>
  <meta name="author" content="Jeff Kunkle">

  
  <meta name="description" content="Automated testing is a critically important practice at Near Infinity.
We try to automate every test we can and run them all the time as part
of a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kunkle.org/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jeff Kunkle's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37321329-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jeff Kunkle's Blog</a></h1>
  
    <h2>a blog about software and related stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kunkle.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/28/nodejs-test-coverage-reporting-with-covershot/">NodeJS Test Coverage Reporting With CoverShot</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-28T00:00:00-04:00" pubdate data-updated="true">Aug 28<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/28/nodejs-test-coverage-reporting-with-covershot/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Automated testing is a critically important practice at Near Infinity.
We try to automate every test we can and run them all the time as part
of a continuous integration process. But how do you know if you&#8217;re tests
are any good? One method for doing so is reporting on your test
<a href="http://en.wikipedia.org/wiki/Code_coverage">code coverage</a>.</p>

<p>If you&#8217;re using Node.js, there are <a href="https://github.com/substack/node-bunker">several</a>
<a href="https://github.com/visionmedia/node-jscoverage">tools</a> for instrumenting
your code for coverage analysis, but none provide a great output format
for easily viewing and navigating the results. That&#8217;s why we decided to
create <a href="http://nearinfinity.github.com/node-covershot/">CoverShot</a>.</p>

<p><a href="http://nearinfinity.github.com/node-covershot/">CoverShot</a> is a
multi-format, test framework agnostic, code coverage
report generator for Node.js applications and modules. That&#8217;s a mouthful
for saying it&#8217;s a tool that generates nice code coverage output in
several formats, no matter which test framework you use. A sample of the
HTML summary page is shown below.</p>

<p><img src="/assets/nodejs_test_coverage_reporting_with_covershot/coverage.png" title="Coverage Summary" alt="Coverage Summary" /></p>

<p>Some of the most interesting features of CoverShot include:</p>

<ul>
<li><strong>Test Framework Agnostic</strong> - It doesn&#8217;t matter which test framework you
use. In fact, your test framework won&#8217;t even know that code
coverage is being collected.</li>
<li><strong>Multi-process Support</strong> - Coverage will be collected even on
code executed by spawned child processes.</li>
<li><strong>Not Tied to Testing</strong> - There&#8217;s nothing about CoverShot that
requires coverage collection to be initiated by tests. You can even use
it to record coverage from your running application.</li>
</ul>


<p>To get started, you&#8217;ll need to install <code>covershot</code> and its dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">$</span>&gt; npm install covershot
</span><span class='line'><span class="gp">$</span>&gt; npm install jsmeter2
</span></code></pre></td></tr></table></div></figure>


<p>You&#8217;ll also need to install <code>jscoverage</code>, which is not an npm package.
Please see <a href="http://siliconforks.com/jscoverage/">this</a> or
<a href="https://github.com/visionmedia/node-jscoverage">this</a> for installation
options.</p>

<p>The first step to beautiful code coverage reports is to instrument your
code using <code>jscoverage</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">$</span>&gt; jscoverage --no-highlight lib lib-cov
</span></code></pre></td></tr></table></div></figure>


<p>This creates a modified version of all the JavaScript files in the lib
directory and its subdirectories, instrumented for coverage collection.</p>

<p>Next, you&#8217;ll need to change the way you require the files you want to
collect coverage on.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">csrequire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;covershot&#39;</span><span class="p">).</span><span class="nx">require</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// coverage will be collected for this file and all files it requires</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">myLibrary</span> <span class="o">=</span> <span class="nx">csrequire</span><span class="p">(</span><span class="s1">&#39;../lib/myLibrary&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&#8217;d like to collect some source code metrics too, run <code>jsmeter2</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">$</span>&gt; ./node_modules/node-jsmeter/bin/jsmeter.js -o ./covershot/jsmeter/ ./lib/
</span></code></pre></td></tr></table></div></figure>


<p>Finally, use <code>covershot</code> to generate the report, in this case an HTML
report.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="gp">$</span>&gt; ./node_modules/covershot/bin/covershot covershot/data -f html
</span></code></pre></td></tr></table></div></figure>


<p>A static set of HTML pages will be generated in the covershot
subdirectory of your current working directory.</p>

<p>It&#8217;s important to realize that good test coverage does not guarantee
error-free code. You can still <a href="http://jasonrudolph.com/blog/testing-anti-patterns-how-to-fail-with-100-test-coverage/">fail with 100% test coverage</a>.
It&#8217;s simply another tool in the toolbox for helping you evaluate the
effectiveness of your tests. Please check it out and let us know how we
can improve CoverShot.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/14/tech-presentation-tip-3-mirror-displays/">Tech Presentation Tip 3 - Mirror Displays</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-14T00:00:00-04:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/14/tech-presentation-tip-3-mirror-displays/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is the third in a series of posts extracted from my <a href="http://www.nearinfinity.com/techtalks/jeff_kunkle/2011/08/15/Presentation_Tips.html">Presentation Tips Video</a> from last year. You can <a href="http://youtu.be/8l6dmfXovto?t=5m54s">jump directly to this tip in the video</a> if you&#8217;d rather watch it than read it.</p>

<p>Most of the presentations I give, and receive, involve software
development. More often than not this involves some amount of live
coding by the presenter. As most developers seem to using Macs these
days they&#8217;re often using Keynote for any slides in their talk.</p>

<p>Keynote has a really handy presenters view that will show the
current slide, next slide, and timing information on your laptop display
while showing the presentation on the secondary display/projector.</p>

<p><img src="/assets/tech_presentation_tip_3/presenter-view.png" title="Presenter View" alt="presenter-view" /></p>

<p>Unfortunately, presenter view and live coding don&#8217;t work well together.
If you&#8217;re using presenter view then your laptop and projector are
showing different images. If you want your audience to see your live
coding you need to place your editor on the secondary display/projector.
This means that while you&#8217;re typing you need to be looking at the
projector&#8217;s display, not the one in front of you. I&#8217;ve never seen this
work out well.</p>

<p>No matter how easy you think it might be, typing while
straining to look over your shoulder is distracting. It&#8217;s bound to be a
comedy of typing errors and comments about how hard it is to type on
your laptop while looking over your shoulder. So just don&#8217;t do it. If
you plan to do any typing during your presentation then ditch
the presenter view and mirror your screens. It&#8217;ll save you some stress
and keep your audience from losing interest in the guy who can&#8217;t type.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/06/tech-presentation-tip-2-no-apologies-or-caveats/">Tech Presentation Tip 2 - No Apologies or Caveats</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-06T00:00:00-04:00" pubdate data-updated="true">Aug 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/06/tech-presentation-tip-2-no-apologies-or-caveats/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is the second in a series of posts extracted from my <a href="http://www.nearinfinity.com/techtalks/jeff_kunkle/2011/08/15/Presentation_Tips.html">Presentation Tips Video</a> from last year. You can <a href="http://youtu.be/8l6dmfXovto?t=12m51s">jump directly to this tip in the video</a> if you&#8217;d rather watch it than read it. While this tip is
not particularly technical, it&#8217;s a big enough problem I encounter often
enough to mention it.</p>

<p>One of the quickest ways to immediately turn your audience off is to begin
the presentation with an apology or caveat. Consider the following
statements from your audience&#8217;s perspective.</p>

<blockquote><p>I didn&#8217;t have much time to prepare.</p></blockquote>

<p>Why should your audience spend their valuable time listening to an
underprepared presentation? Respect your audience by budgeting
sufficient prep time to create a compelling talk.</p>

<blockquote><p>I hope this makes sense.</p></blockquote>

<p>You should never present something you aren&#8217;t sure makes sense. Run your
outline by a freind or colleague before ever starting to make sure it&#8217;s
coherent and organized. It&#8217;s also a great idea to do a dry run or two
beforehand with someone you trust to give you honest feedback.</p>

<blockquote><p>I just finished this presentation last night.</p></blockquote>

<p>To your audience it sounds like you didn&#8217;t care enough about your topic
and their time to put in a serious effort. If I hear this I immediately
expect a poor presentation and that&#8217;s normally what I get.</p>

<blockquote><p>This is my first time presenting this.</p></blockquote>

<p>Even if it is your first time with a new presentation, there&#8217;s little
value in stating it. You&#8217;re only giving your audience a reason to tune
out rather than engage.</p>

<blockquote><p>I&#8217;m not very good at presenting.</p></blockquote>

<p>This is another one of those statements that can only hurt your
presentation. If you&#8217;re nervous, people will generally understand,
assuming they even notice. You don&#8217;t need to declare it.</p>

<p>A good presentation involves a lot of things, but above all
confidence. These and similar caveats are generally a symptom of a lack
of confidence in your presentation or your ability to present it. If your
audience senses a lack of confidence from you, they&#8217;ll lose confidence
in the presentation too.</p>

<p>The best way to combat a crisis of confidence is to prepare, prepare,
and prepare. If you&#8217;re prepared, you&#8217;ll have no reason to apologize or
caveat beforehand, and the confidence will take care of itself.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/26/tech-presentation-tip-1-avoid-screen-resolution-shock/">Tech Presentation Tip 1 - Avoid Screen Resolution Shock</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-26T00:00:00-04:00" pubdate data-updated="true">Jul 26<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/26/tech-presentation-tip-1-avoid-screen-resolution-shock/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is the first in a series of posts extracted from my <a href="http://www.nearinfinity.com/techtalks/jeff_kunkle/2011/08/15/Presentation_Tips.html">Presentation Tips Video</a> from last year. There’s an endless supply of books, articles, blog posts, and videos to help you improve your presentations, but most of them focus on the organization and delivery aspects of presenting. These tips target some of the technical aspects surrounding your presentation, such as making sure you have the right adapter for your projector, preparing for screen-resolution changes, and a whole bunch more. Hopefully you can learn something from my observations and personal gaffes over the years.</p>

<p>If you&#8217;re a developer, chances are you do most work with your screen resolution cranked up as high as it&#8217;ll go. As I write this, my pre-retina 15-inch MacBook Pro resolution is set at 1440x900. So what happens when you plug your laptop into a projector displaying at 1024x768?</p>

<p><img src="/assets/tech_presentation_tip_1/hires.png" title="High Resolution Laptop" alt="hires" /></p>

<p><img src="/assets/tech_presentation_tip_1/lowres.png" title="Low Resolution Projector" alt="lowres" /></p>

<p>Suddenly everything that fit so nicely on your laptop screen has been zoomed in to the point where things are barely recognizable. And despite this predictable behavior, I continue to see &#8220;screen resolution shock&#8221; derail presentation after presentation as the presenter scrambles to rearrange windows and figure out how to operate with the reduced real estate.</p>

<p>Consider these tips as you prepare for your next presentation.</p>

<ol>
<li>If you have access to the projector you&#8217;ll be using, try it ahead of time and find the best resolution.</li>
<li>If you don&#8217;t have access to the projector, call ahead and ask about the available resolutions. Unfortunately, people don&#8217;t usually know.</li>
<li>If you don&#8217;t know the resolution ahead of time, assume 1024x768.</li>
<li>Practice your presentation at the resolution you expect from the projector, not at your laptop&#8217;s resolution.</li>
</ol>


<p>Of these, tip number four is clearly the most important. If you don&#8217;t practice at the resolution you expect from the projector, you can count on screen resolution shock being a distraction for you and your audience.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/12/introducing-db-meta-for-nodejs/">Introducing Db-meta for NodeJS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-12T00:00:00-04:00" pubdate data-updated="true">Jul 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/12/introducing-db-meta-for-nodejs/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&#8217;re using NodeJS and are in need of schema metadata from your relational database, you&#8217;re in luck. <a href="https://github.com/nearinfinity/node-db-meta">db-meta</a> provides an API to retrieve basic schema metadata from MySQL, PostgreSQL, and SQLite databases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">dbmeta</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;db-meta&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dbmeta</span><span class="p">(</span><span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">database</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">meta</span><span class="p">.</span><span class="nx">getVersion</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;postgres version is &#39;</span> <span class="o">+</span> <span class="nx">version</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">meta</span><span class="p">.</span><span class="nx">getTables</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tables</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">tables</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;table name is &#39;</span> <span class="o">+</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getName</span><span class="p">());</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">meta</span><span class="p">.</span><span class="nx">getColumns</span><span class="p">(</span><span class="s1">&#39;tablename&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columns</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">columns</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">column</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;column name is &#39;</span> <span class="o">+</span> <span class="nx">column</span><span class="p">.</span><span class="nx">getName</span><span class="p">());</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;column data type is &#39;</span> <span class="o">+</span> <span class="nx">column</span><span class="p">.</span><span class="nx">getDataType</span><span class="p">());</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;column is nullable? &#39;</span> <span class="o">+</span> <span class="nx">column</span><span class="p">.</span><span class="nx">isNullable</span><span class="p">());</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;column max length is &#39;</span> <span class="o">+</span> <span class="nx">column</span><span class="p">.</span><span class="nx">getMaxLength</span><span class="p">());</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&#8217;re interested in learning more, check out the <a href="https://github.com/nearinfinity/node-db-meta">db-meta Github page</a> for additional information and API documentation.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/28/node.js-podcast-on-ibm-developerworks/">Node.js Podcast on IBM developerWorks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-28T00:00:00-04:00" pubdate data-updated="true">Jun 28<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/28/node.js-podcast-on-ibm-developerworks/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Almost two months ago I did a 28-minute <a href="http://www.ibm.com/developerworks/podcast/glover-kunkle-042712/glover-kunkle-042712.mp3">podcast</a> with Andy Glover for IBM developerWorks explaining the basics of Node, dispelling some misconceptions, and describing how it views the world a bit differently. I apologize for not posting about it earlier. You can find a brief description of the podcast and some helpful related links <a href="http://www.ibm.com/developerworks/java/library/j-gloverpodcast4/index.html#kunkle">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/13/secret-sauce-of-nodejs-modules/">Secret Sauce of NodeJS Modules</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-13T00:00:00-04:00" pubdate data-updated="true">Jun 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/13/secret-sauce-of-nodejs-modules/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I first starting learning about Node.js I read lots of blog posts and tutorials filled with examples. After all, there weren&#8217;t any published books or comprehensive guides at the time. With my primary JavaScript frame of reference being its use in the browser, one thing that always puzzled me early on is how Node could possibly prevent me from creating global variables. Consider the following contrived code example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">sayHello</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello there &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">exports</span><span class="p">.</span><span class="nx">greet</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">sayHello</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the above code were run in a browser I would have created a global function named <code>sayHello</code> and attached a function named <code>greet</code> to a global <code>exports</code> object. But that isn&#8217;t what happens at all when using Node.</p>

<p>After some digging I came to learn that Node uses the <a href="http://www.commonjs.org/">CommonJS</a> module pattern. Reading about CommonJS you&#8217;ll learn that there&#8217;s a magic <code>exports</code> variable available to your scripts, and anything attached to it is exposed to other code <code>require</code>&#8216;ing your script. That&#8217;s all well and good and I understood the concept, but it didn&#8217;t help me understand how it actually worked under the covers. How did it prevent functions like <code>sayHello</code> from becoming global and just where did that <code>exports</code> variable come from? So I resorted to digging through the Node source to find out what&#8217;s really going on.</p>

<p>Fortunately, it didn&#8217;t take long for me to stumble upon some code in <code>src/node.js</code>; It might have even been the first file I opened. On line 528 (Node version 0.6.18) you&#8217;ll find the chunk of code shown below. Start reading at the compile function near the bottom. The first two things <code>compile</code> does is get the source of your script and then wrap it. Notice the <code>NativeModule.wrap</code> function is actually wrapping your entire source file in an anonymous function expression, exposing <code>exports</code>, <code>require</code>, <code>module</code>, <code>__filename</code>, and <code>__dirname</code> variables to your code. The wrapped source is then invoked in the <code>compile</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">NativeModule</span><span class="p">.</span><span class="nx">wrap</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">NativeModule</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">script</span> <span class="o">+</span> <span class="nx">NativeModule</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">NativeModule</span><span class="p">.</span><span class="nx">wrapper</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="s1">&#39;(function (exports, require, module, __filename, __dirname) { &#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;\n});&#39;</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="nx">NativeModule</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">NativeModule</span><span class="p">.</span><span class="nx">getSource</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">source</span> <span class="o">=</span> <span class="nx">NativeModule</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">runInThisContext</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">fn</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">NativeModule</span><span class="p">.</span><span class="nx">require</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">filename</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The important part to take away from this is that Node does not run exactly what you&#8217;ve written in your source file; it runs a wrapped version of your source. This wrapped function expression is the tactic used to prevent your top level functions and variables from becoming global. It&#8217;s also how your code gets access to the magic <code>exports</code> variable, among others.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/13/nodejs-basics-explained/">Node.js Basics Explained</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-13T10:02:42-04:00" pubdate data-updated="true">Apr 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/04/13/nodejs-basics-explained/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rising from non-existence three short years ago, Node.js is already attracting the accolades and disdain enjoyed and endured by the Ruby and Rails community just a short time ago. It overtook Rails as the most popular Github repository last November (now superseded by Twitter&#8217;s Bootstrap project) and was selected by InfoWorld for the Technology of the Year Award in 2012.</p>

<p>If you&#8217;ve never used Node.js before or have limited experience, it may not be obvious why people are so excited about it. This post will attempt to explain the basic theory central to Node&#8217;s approach, arming you with a better frame of reference for the debates you&#8217;ll undoubtedly encounter.</p>

<p>Please note that this post won&#8217;t make much sense without a very basic familiarity with Node. Consider checking out the <a href="http://nodejs.org">Node.js website</a> and reading a few articles on Node first if that&#8217;s the case.</p>

<h1>I/O Latency</h1>

<p>The core premise behind Node&#8217;s approach is that I/O operations are slow compared to the computation done in your application. Consider the table below, taken from Ryan Dahl&#8217;s 2008.11.08 presentation on Node.js. It shows various I/O operations on the left and the number of CPU cycles it takes to perform them. Don&#8217;t focus on the actual numbers, but on the differences in magnitude for the  operations.</p>

<table>
    <tr><th>Operation</th><th>CPU cycles</th></tr>
    <tr><td>L1</td><td align="right">3</td></tr>
    <tr><td>L2</td><td align="right">14</td></tr>
    <tr><td>RAM</td><td align="right">250</td></tr>
    <tr><td>Disk</td><td align="right">41,000,000</td></tr>
    <tr><td>Network</td><td align="right">240,000,000</td></tr>
</table>


<p>From the table you can see that disk and network access times dwarf things like memory access or L1 and L2 cache access. The chart below makes the magnitude differences even more obvious. The L1, L2, and RAM access times are so much smaller than disk and network access that their bars don&#8217;t even appear on the graph.</p>

<p><img src="/assets/latency-bar-graph.png" title="I/O Latency" alt="i/o magnitudes" /></p>

<h1>Waiting</h1>

<p>If you can buy that I/O operations are often orders of magnitude slower than the computation you&#8217;re performing in your app, then what is your app doing during the I/O operations? It&#8217;s waiting! It&#8217;s execution is literally blocked until the I/O operation completes.</p>

<p>Consider the following fictitious web request. The slim green bars represent the time your application devotes to processing and the gray bars represent the time spent waiting for I/O to complete. The example starts off with some logic to process the request.</p>

<ol>
<li>Parse the request and invoke the appropriate controller logic</li>
<li>Initiate a database query or maybe a request to an external service</li>
<li>Wait for I/O</li>
<li>Process the query results and write some data to a log file</li>
<li>Wait for I/O</li>
<li>Perform some final formatting of the results and return them to the client</li>
</ol>


<p><img src="/assets/waiting.png" title="Waiting" alt="waiting" /></p>

<p>The vast majority of time spent during the request involved waiting for the I/O operations, and there were only two. Very little time is actually used to perform application-specific processing. Node.js was designed from the start to exploit this imbalance.</p>

<h1>Scaling</h1>

<p>Before we get into the approach Node.js takes to scaling, let&#8217;s consider how our made-up web request would be scaled with other models.</p>

<h2>Scaling with Threads</h2>

<p>Using a thread based model, you&#8217;d scale the above example by creating multiple threads, one for each concurrent connection. The diagram below depicts a threaded model capable of handling four concurrent connections.</p>

<p><img src="/assets/scaling-threads.png" title="Scaling with Threads" alt="scaling with threads" /></p>

<p>While this approach allows us to scale by adding more threads, each thread still spends most of its time waiting for I/O, not processing your application logic. Unfortunately, continuing to add threads introduces context switching overhead and uses considerable memory to maintain execution stacks.</p>

<h2>Scaling with Processes</h2>

<p>Another popular approach to scaling your application is to run multiple processes. As you can see from the diagram below, the theory behind scaling with multiple processes is basically the same as scaling with threads, although it does use more memory. Like the threading model, each process still spends most of its time waiting on I/O.</p>

<p><img src="/assets/scaling-processes.png" title="Scaling with Processes" alt="scaling with processes" /></p>

<h2>Scaling with Node.js</h2>

<p>Since the code you write for Node.js executes in a single thread within a single process, it takes a different approach to scaling. It extracts the &#8220;I/O waiting&#8221; by using an internal thread pool or leveraging asynchronous I/O APIs of the host operating system to free your thread for processing other connections. Instead of your code blocking on I/O operations, it&#8217;s freed to process other connections. When the I/O operation completes, your code is called back to handle the results.</p>

<p><img src="/assets/scaling-event-loop.png" title="Scaling with Node.js" alt="scaling with event loop" /></p>

<p>With Node.js your code never blocks for I/O operations, eliminating those long gray bars of waiting time. This non-blocking mode of operation is what allows Node.js to handle large numbers of concurrent connections without overly-straining system resources.</p>

<h1>Conclusion</h1>

<p>The success of Node.js relies on the premise that time spent waiting for I/O far outweighs the time spent executing application logic. While that&#8217;s true of many of todays&#8217; web/network-based applications, it doesn&#8217;t always apply. If your application is more CPU-intensive with minimal I/O by comparison, then Node.js is probably not the right platform. As my father used to say, don&#8217;t try to fit a square peg in a round hole.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/26/automatic-code-coverage-switch/">Automatic Code Coverage Switching for Vows.js</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-26T15:22:16-05:00" pubdate data-updated="true">Jan 26<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/26/automatic-code-coverage-switch/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p> If you&#8217;ve used <a href="http://nodejs.org">Node.js</a> lately you&#8217;ve likely run across <a href="http://vowsjs.org/">Vows</a>, the asynchronous behavior driven development test framework for Node. Vows does a really nice job of forcing you to separate your setup logic from your assertions, but that&#8217;s not what this post is about.</p>

<p>Vows can generate test coverage reports with its &#8211;cover-plain, &#8211;cover-html, and &#8211;cover-json options. Unfortunately, creating code coverage metrics isn&#8217;t as straightforward as simply including these options in your call to vows. You need to</p>

<ol>
<li>Pre-instrument your code using <a href="https://github.com/visionmedia/node-jscoverage">node-jscoverage</a>.</li>
<li>Require the instrumented versions of your code from your tests.</li>
</ol>


<p>The first prerequisite is fairly easy to satisfy, although you need to remember to re-run node-jscoverage any time you change the source files you&#8217;re interested in covering. Setting up a script using something like <a href="https://github.com/balupton/watchr">watchr</a> to re-instrument your files if anything changes might be a good option. Anyway, simply executing the following (assuming you&#8217;ve installed node-jscoverage and added it to your path) from the root of your node project will create the instrumented versions of the files in your lib directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>node-jscoverage lib lib-cov
</span></code></pre></td></tr></table></div></figure>


<p>The second prerequisite is not as straightforward to resolve as you might expect unless you want to generate the code coverage on every test run. Why? Because requiring the instrumented code from your test is not the same as requiring the un-instrumented versions. Consider</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// test/myfile_test.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">fut</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/myfile.js&#39;</span><span class="p">);</span> <span class="c1">// regular version</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">fut</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib-cov/myfile.js&#39;</span><span class="p">);</span> <span class="c1">// instrumented version</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since the statement requiring the file under test is in every test you write, having to change it when you want to run the instrumented or un-instrumented files is, in my opinion, not an option. So, on my current project we wrote the following javascript to to serve as a replacement to requiring your files under test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// test/coverage.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">covererageOn</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="sr">/^--cover/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">covererageOn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Code coverage on&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">exports</span><span class="p">.</span><span class="nx">require</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">instrumentedPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/lib&#39;</span><span class="p">,</span> <span class="s1">&#39;/lib-cov&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">require</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">instrumentedPath</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="nx">instrumentedPath</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Coverage on, but no instrumented file found at &#39;</span>
</span><span class='line'>        <span class="o">+</span> <span class="nx">instrumentedPath</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Code coverage off&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">exports</span><span class="p">.</span><span class="nx">require</span> <span class="o">=</span> <span class="nx">require</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In essence, the script checks the process arguments to see if one of the vows &#8211;cover-* arguments were passed and changes its require method to substitute /lib-cov for any /lib references. If none of the coverage arguments are detected it simply requires the file as usual. Since your files under test normally use relative references to other files in your lib directory, they get covered too. Check out the example below to see how you would use the script in a test.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// test/mytest.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">vows</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vows&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">coverage</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">fileUnderTest</span> <span class="o">=</span> <span class="nx">coverage</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/myfile.js&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">vows</span><span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;your test&#39;</span><span class="p">).</span><span class="nx">addBatch</span><span class="p">({</span>
</span><span class='line'>    <span class="c1">// do some testing</span>
</span><span class='line'><span class="p">}).</span><span class="kr">export</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/12/parsing-pcap-files-in-nodejs-w/">Parsing Pcap Files in Node.js With Pcap-parser</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-12T08:00:00-05:00" pubdate data-updated="true">Jan 12<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/12/parsing-pcap-files-in-nodejs-w/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>On my current project we&#8217;ve been using <a href="http://nodejs.org">Node.js</a> for an app that does a lot of packet capture and processing. In the past we used <a href="https://github.com/mranney/node_pcap">node-pcap</a> for packet capture but were looking for an easier way to simply parse raw pcap files. It turns out the <a href="http://wiki.wireshark.org/Development/LibpcapFileFormat">pcap file format</a> is pretty simple as was writing a node module to parse it.</p>

<p>The module, called <a href="https://github.com/nearinfinity/node-pcap-parser">pcap-parser</a>, can be used to parse any pcap file or readable pcap stream, such as the piped output of <a href="http://www.tcpdump.org/">tcpdump</a>. As packets are parsed, pcap-parser emits relevant events to which your node program can listen. It&#8217;s a really simple way to process a theoretically infinite stream of pcap data. The code below shows a basic example of it in action. Please check out the <a href="https://github.com/nearinfinity/node-pcap-parser">project page</a> for more details.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">pcapp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pcap-parser&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">pcapp</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;/path/to/file.pcap&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// var parser = pcapp.parse(process.stdin);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">parser</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;packet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">packet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">header</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">packet</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/08/28/nodejs-test-coverage-reporting-with-covershot/">NodeJS Test Coverage Reporting with CoverShot</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/14/tech-presentation-tip-3-mirror-displays/">Tech Presentation Tip 3 - Mirror Displays</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/06/tech-presentation-tip-2-no-apologies-or-caveats/">Tech Presentation Tip 2 - No Apologies or Caveats</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/26/tech-presentation-tip-1-avoid-screen-resolution-shock/">Tech Presentation Tip 1 - Avoid Screen Resolution Shock</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/12/introducing-db-meta-for-nodejs/">Introducing db-meta for NodeJS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/kunklejr">@kunklejr</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kunklejr',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("kunklejr", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/kunklejr" class="twitter-follow-button" data-show-count="false">Follow @kunklejr</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/kunklejr?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jeff Kunkle -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jkunkle-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
